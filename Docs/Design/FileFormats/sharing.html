<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 * This Source Code Form is subject to the terms of the Mozilla Public License,
 * v. 2.0. If a copy of the MPL was not distributed with this file, You can
 * obtain one at http://mozilla.org/MPL/2.0/
 *
 * Copyright (C) 2020, Peter Johnson (www.delphidabbler.com).
 *
 * CodeSnip File Format Documentation: Sharing Files
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>

<title>
  CodeSnip File Format Documentation - Sharing Files
</title>

<link
  rel="stylesheet"
  type="text/css"
  media="screen"
  href="main.css"
/>

</head>

<body>

<div class="title">
  <div class="index-link">
    <a href="index.html">Back to Index</a>
  </div>
  <div>
    DelphiDabbler CodeSnip
  </div>
  <div class="subtitle">
    File Format Documentation
  </div>
</div>


<h1>
  Sharing Files
</h1>


<h2>
  Introduction
</h2>

<p>
  The Sharing file format is used to share one or more snippets between users. CodeSnip can export snippets in sharing files and import snippets from them.
</p>

<p>
  The format can also be used to package collections of snippets for publication online.
</p>

<p class="pullout">
  Note that this file format was introduced with CodeSnip 5. It is a different format to the <a href="legacy-export.html">Export</a> format used by earlier versions of CodeSnip.
</p>


<h2>
  File Format
</h2>

<p>
  The sharing file format is two tier.
</p>

<p>
  The inner tier comprises a collection of text files all located in the same directory. There is a single <a href="#master_file">master</a> file in XML format that describes the snippets and tags to be shared. For each snippet there is also a separate <a href="#source_files">source code</a> file. Finally there is a single <a href="#license_file">license</a> file.
</p>

<p>
  All the above files are then packaged together in a single binary <a href="#package_files">package file</a> for distribution.
</p>

<p class="pullout">
  The inner tier files use text files, rather than the binary files used for database files. This is done to ease development of sharable snippet collections in version control repositories such as Git.
</p>

<p>
  All three formats are described below.
<p>


<h3 id="master_file">
  Master File Format
</h3>

<p>
  The single master file is an XML file. It is UTF&#8209;8 encoded with no UTF&#8209;8 preamble (BOM). The XML processing instruction identfies the file as UTF&#8209;8 format.
</p>

<p>
  Valid tags are described below.
</p>

<dl>
  <dt>
    <strong><em>XML processing instruction</em></strong>
  </dt>
  <dd>
    <div class="half-spaced">
      <em>Attributes:</em>
    </div>
    <dl class="indent">
      <dt>
        <em>version</em>
      </dt>
      <dd>
        Always set to <kbd class="value">1.0</kbd>
      </dd>
      <dt>
        <em>encoding</em>
      </dt>
      <dd>
        Always set to <kbd class="value">UTF&#8209;8</kbd>
      </dd>
    </dl>
  </dd>

  <dt>
    <strong>codesnip-share</strong>
  </dt>
  <dd>
    <div class="half-spaced">
      Parent node for whole document.
    </div>
    <div class="half-spaced">
      <em>Attributes:</em>
    </div>
    <dl class="indent">
      <dt>
        <em>watermark</em>
      </dt>
      <dd>
        Identifies file as correct type &ndash; always set to
        <kbd class="value">2089C281&#8209;0B16&#8209;42DC&#8209;BCB6&#8209;6668C217188F</kbd>.
      </dd>
      <dt>
        <em>version</em>
      </dt>
      <dd>
        Identifies version of file &ndash; always set to <kbd class="value">1</kbd>.
      </dd>
      <dt>
        <em>generator</em> <em>(optional)</em>
      </dt>
      <dd>
        Identifies any program used to generate the share. Shares generated by CodeSnip will set this attribute, for e.g. <kbd class="value">CodeSnip 5.0.0</kbd>.
      </dd>
    </dl>
  </dd>

  <dt>
    <strong>codesnip-share/share</strong>
  </dt>
  <dd>
    <div class="half-spaced">
      Contains information about this particular share.
    </div>
    <div class="half-spaced">
      <em>Attributes:</em>
    </div>
    <dl class="indent">
      <dt>
        <em>origin</em>
      </dt>
      <dd>
        Unique identifier of this share. Shares generated by CodeSnip <strong>must</strong> use a GUID here. Providers of 3rd party shares may use an id based on their own domain, if any. If a 3rd party provides two or more shares then each <strong>must</strong> be unique within the domain, For e.g.: <kbd class="value">com.example.my-1st-share</kbd>. If the share provider does not have a domain name then a GUID <strong>must</strong> be used.
      </dd>
      <dt>
        <em>revision</em>
      </dt>
      <dd>
        <div class="half-spaced">
          The revision number of this share. <strong>Must</strong> be a non-negative integer.
        </div>
        <div class="half-spaced">
          For shares generated by CodeSnip a value of <kbd class="value">0</kbd>is always used. 3rd party providers may issue bug fixes and updates. The original release <strong>must</strong> have revision number <kbd class="value">0</kbd> For each subsequent update the revision number <strong>must</strong> be bumped by 1.
      </dt>
    </dl>
  </dd>

  <dt>
    <strong>codesnip-share/share/description</strong> <em>(optional)</em>
  </dt>
  <dd>
    <div class="half-spaced">
      A plain text description of the share.
    </div>
  </dd>

  <dt>
    <strong>codesnip-share/share/license/description</strong>
  </dt>
  <dd>
    <div class="half-spaced">
      A plain text description of the license. E.g. <kbd class="value">MIT License</kbd>.
    </div>
  </dd>

  <dt>
    <strong>codesnip-share/share/license/url</strong> <em>(optional)</em>
  </dt>
  <dd>
    <div class="half-spaced">
      The URL of the license online. Must be a valid URL.
    </div>
  </dd>

  <dt>
    <strong>codesnip-share/share/publisher</strong> <em>(optional)<sup>&dagger;</sup></em>
  </dt>
  <dd>
    <div class="half-spaced">
      Contains information about the publisher of the share.
    </div>
    <div class="half-spaced">
      <strong>&dagger; Note:</strong> This node is only optional for shares generated by CodeSnip. 3rd party providers <strong>must</strong> supply this information.
    </div>
  </dd>

  <dt>
    <strong>codesnip-share/share/publisher/name</strong>
  </dt>
  <dd>
    <div class="half-spaced">
      The name of the publisher as plain text.
    </div>
  </dd>

  <dt>
    <strong>codesnip-share/share/publisher/url</strong> <em>(optional)<sup>&dagger;</sup></em>
  </dt>
  <dd>
    <div class="half-spaced">
      The URL of the share online.<sup>&dagger;</strong>
    </div>
    <div class="half-spaced">
      <strong>&dagger; Note:</strong> This node is only optional for shares generated by CodeSnip. 3rd party providers <strong>must</strong> supply this information.
    </div>
  </dd>

  <dt>
    <strong>codesnip-share/share/publisher/contact</strong> <em>(optional)</em>
  </dt>
  <dd>
    <div class="half-spaced">
      Publisher's contact details as plain text.
    </div>
    <div class="half-spaced">
      The following will be automatically recognised:
    </div>
    <ul class="squashed">
      <li>
        Web address beginning with <kbd class="value">http:\\</kbd> or <kbd class="value">https://</kbd>.
      </li>
      <li>
        Email addresses beginning with <kbd class="value">mailto:</kbd>.
      </li>
      <li>
        Twitter handles beginning with <kbd class="value">@</kbd>.
      </li>
      <li>
        Phone numbers in international format beginning with <kbd class="value">+</kbd> and followed by a valid phone number. Only digits, hyphens and spaces are permitted.
      </li>
    </ul>
    <div class="spaced">
      For alll other contact methods the method <strong>must</strong> be described in plain text.
    </div>
    <div class="half-spaced">
      Examples values are:
    </div>
    <ul class="squashed">
      <li>
        Email: <kbd class="value">mailto:joe.bloggs@example.com</kbd>.
      </li>
      <li>
        Web: <kbd class="value">https://example.com/contact-me.php</kbd>.
      </li>
      </li>
        Phone: <kbd class="value">+44 123 456789</kbd> or <kbd class="value">+44-123-456789</kbd> or <kbd class="value">+44123456789</kbd>.
      <li>
        Twitter: <kbd class="value">@joebloggs</kbd>
      <li>
        Facebook messenger: <kbd class="value">Facebook messenger user name: fredbloggs</kbd>.
      </li>
      <li>
        Post: <kbd class="value">Postal Address: Joe Bloggs, 1 Sunshine Avenue, Sunnnytown, Shropshire, ZZ12 3ZZ, UK.</kbd>
      </li>
    </ul>
  </dd>

  <dt>
    <strong>codesnip-share/snippet-id-prefix</strong> <em>(optional)</em>
  </dt>
  <dd>
    <div class="half-spaced">
      Specifies a prefix to be added to all snippet ids specified in the share before inserting them into the user's database. For e.g.: <kbd class="value">_248EA40C_</kbd>.
    </div>
    <div class="half-spaced">
      A prefix <strong>must</strong> contain only letters, numbers, hyphen and underscore characters.
    </div>
  </dd>

  <dt>
    <strong>codesnip-share/snippets</strong>
  </dt>
  <dd>
    <div class="half-spaced">
      Contains all snippets in the share.
    </div>
  </dd>

  <dt>
    <strong>codesnip-share/snippets/snippet</strong>
  </dt>
  <dd>
    <div class="half-spaced">
      Contains information about an exported snippet. One node per snippet.
    </div>
    <div class="half-spaced">
      <em>Attributes:</em>
    </div>
    <dl class="indent">
      <dt>
        <em>id</em>
      </dt>
      <dd>
        <div class="half-spaced">
          Globally unique ID of the snippet.
        </div>
        <div class="half-spaced">
          For snippets generated by CodeSnip 5 and later the ID is a GUID. Snippets created in earlier versions of CodeSnip are often named with the snippet's display name. In the latter case the <em>codesnip-share/snippet-id-prefix</em> node <strong>must</strong> specify a value to prepend to the snippet id to smake it unique.
        </div>
        <div class="half-spaced">
          Snippet IDs <strong>must</strong> contain only letters, numbers, hyphens or underscore characters. The total length of a snippet id, including any prefix, <strong>must not</strong> exceed 64 characters.
        </div>
      </dd>
    </dt>
  </dd>

  <dt>
    <strong>codesnip-share/snippets/snippet/title</strong>
  </dt>
  <dd>
    <div class="half-spaced">
      The title of the snippet, in plain text. Should, but need not, be unique. A non empty value <strong>must</strong> be provided.
    </div>
  </dd>

  <dt>
    <strong>codesnip-share/snippets/snippet/description</strong>
  </dt>
  <dd>
    <div class="half-spaced">
      Description of the snippet. The description <strong>must</strong> be formatted as REML mark-up. REML up to v4 is supported.
    </div>
    <div class="half-spaced">
      The REML code <strong>must</strong> be HTML encoded.
    </div>
  </dd>

  <dt>
    <strong>codesnip-share/snippets/snippet/notes</strong> <em>(optional)</em>
  </dt>
  <dd>
    <div class="half-spaced">
      Additional notes about of snippet. Notes <strong>must</strong> be formatted as REML mark-up. REML up to v4 is supported.
    </div>
    <div class="half-spaced">
      The REML code <strong>must</strong> be HTML encoded.
    </div>
  </dd>

  <dt>
    <strong>codesnip-share/snippets/snippet/tags</strong> <em>(optional)</em>
  </dt>
  <dd>
    <div class="half-spaced">
      Contains a list of the snippet's associated tags.
    </div>
  </dd>

  <dt>
    <strong>codesnip-share/snippets/snippet/tags/tag</strong>
  </dt>
  <dd>
    <div class="half-spaced">
      A single tag associated with the snippet as plain text. One node per tag.
    </div>
  </dd>

  <dt>
    <strong>codesnip-share/snippets/snippet/source-code-file</strong>
  </dt>
  <dd>
    <div class="half-spaced">
      Name of the file containing the snippet's source code, without path information.
    </div>
  </dd>

  <dt>
    <strong>codesnip-share/snippets/snippet/source-language</strong>
  </dt>
  <dd>
    <div class="half-spaced">
      Specifies the ID of the source language used by the snippet.
    </div>
    <div class="half-spaced">
      This node has no text content.
    </div>
    <div class="half-spaced">
      <em>Attributes:</em>
    </div>
    <dl class="indent">
      <dt>
        <em>id</em>
      </dt>
      <dd>
        <div class="half-spaced">
          Language identifier.
        </div>
        <div class="half-spaced">
           If this ID is not one of the standard languages supported by CodeSnip then details of the language should be provided to users so they can add the language to their version of CodeSnip.
        </div>
        <div class="half-spaced">
          If this ID is not recognised then the Snippet will be interpretted by CodeSnip as having the default language.
        </div>
      </dd>
  </dd>

  <dt>
    <strong>codesnip-share/snippets/snippet/kind</strong>
  </dt>
  <dd>
    <div class="half-spaced">
      Value indicating kind of snippet.
    </div>
    <div class="half-spaced">
      Permissible values are: <kbd class="value">freeform</kbd>, <kbd class="value">routine</kbd>, <kbd class="value">type</kbd>, <kbd class="value">const</kbd>, <kbd class="value">class</kbd> &amp; <kbd class="value">unit</kbd>.
    </div>
  </dd>

  <dt>
    <strong>codesnip-share/snippets/snippet/compiler-results</strong> <em>(optional)<sup>&dagger;</sup></em>
  </dt>
  <dd>
    <div class="half-spaced">
      Contains a list of compile results for the snippet.
    </div>
    <div class="half-spaced">
      <strong>&dagger; Note:</strong> This node should always be omitted for source languages other than Pascal because it has no meaning. If the node is omitted for Pascal source this means that the snippet has not been test compiled at all.
    </div>
  </dd>

  <dt>
    <strong>codesnip-share/snippets/snippet/compiler-results/compiler-result</strong>
  </dt>
  <dd>
    <div class="half-spaced">
      Discribes a compile result for one of the compilers supported by CodeSnip.
    </div>
    <div class="half-spaced">
      There <strong>must</strong> be a node for each compiler with a known compiler result. Nodes for compilers with no known result <strong>must not</strong> be included.
    </div>
    <div class="half-spaced">
      These nodes have no text content.
    </div>
    <div class="half-spaced">
      <em>Attributes:</em>
    </div>
    <dl class="indent">
      <dt>
        <em>id</em>
      </dt>
      <dd>
        <div class="half-spaced">
          Identifies a compiler. Valid attribute values are:
        </div>
        <ul class="squashed">
          <li>
            <kbd class="value">d2</kbd> &ndash; Delphi 2 compiler
          </li>
          <li>
            <kbd class="value">d3</kbd> &ndash; Delphi 3 compiler
          </li>
          <li>
            <kbd class="value">d4</kbd> &ndash; Delphi 4 compiler
          </li>
          <li>
            <kbd class="value">d5</kbd> &ndash; Delphi 5 compiler
          </li>
          <li>
            <kbd class="value">d6</kbd> &ndash; Delphi 6 compiler
          </li>
          <li>
            <kbd class="value">d7</kbd> &ndash; Delphi 7 compiler
          </li>
          <li>
            <kbd class="value">d2005</kbd> &ndash; Delphi 2005 compiler
          </li>
          <li>
            <kbd class="value">d2006</kbd> &ndash; Delphi 2006 compiler
          </li>
          <li>
            <kbd class="value">d2007</kbd> &ndash; Delphi 2007 compiler
          </li>
          <li>
            <kbd class="value">d2009</kbd> &ndash; Delphi 2009 compiler
          </li>
          <li>
            <kbd class="value">d2010</kbd> &ndash; Delphi 2010 compiler
          </li>
          <li>
            <kbd class="value">dXE</kbd> &ndash; Delphi XE compiler
          </li>
          <li>
            <kbd class="value">dXE2</kbd> &ndash; Delphi XE2 compiler
          </li>
          <li>
            <kbd class="value">dXE3</kbd> &ndash; Delphi XE3 compiler
          </li>
          <li>
            <kbd class="value">dXE4</kbd> &ndash; Delphi XE4 compiler.
          </li>
          <li>
            <kbd class="value">dXE5</kbd> &ndash; Delphi XE5 compiler
          </li>
          <li>
            <kbd class="value">dXE6</kbd> &ndash; Delphi XE6 compiler
          </li>
          <li>
            <kbd class="value">dXE7</kbd> &ndash; Delphi XE7 compiler
          </li>
          <li>
            <kbd class="value">dXE8</kbd> &ndash; Delphi XE8 compiler
          </li>
          <li>
            <kbd class="value">d10s</kbd> &ndash; Delphi 10 Seattle compiler
          </li>
          <li>
            <kbd class="value">fpc</kbd> &ndash; Free Pascal compiler
          </li>
        </ul>
      </dd>
      <dt>
        <em>result</em>
      </dt>
      <dd>
        <div class="half-spaced">
          Specifies a compile result for the identified compiler. Valid attribute values are:
        </div>
        <ul class="squashed">
          <li>
            <kbd class="value">Y</kbd> &ndash; Compiles with the identified compiler.
          </li>
          <li>
            <kbd class="value">N</kbd> &ndash; Does not compile with the identified compiler.
          </li>
          <li>
            <kbd class="value">Q</kbd> &ndash; Compile result for this compiler is not known.
          </li>
        </ul>
      </dd>
    </dl>
  </dd>

  <dt>
    <strong>codesnip-share/snippets/snippet/required-modules</strong> <em>(optional)</em>
  </dt>
  <dd>
    <div class="half-spaced">
      Contains a set of nodes that specify modules required by the snippet.
    </div>
    <div class="half-spaced">
      This node has special significance when the source language is Pascal. It is used when test compiling Pascal snippets to ensure that any modules (units) required to compile this snippet are referened in the unit used to perform the test compile.
    </div>
  </dd>

  <dt>
    <strong>codesnip-share/snippets/snippet/required-module/module</strong>
  </dt>
  <dd>
    <div class="half-spaced">
      Contains the name of one required module.
    </div>
    <div class="half-spaced">
      If the <em>codesnip-share/snippets/snippet/source-language</em> has an <em>id</em> attribute of <kbd class="value">Pascal</kbd> then this name <strong>must</strong> be a valid Pascal unit identifier.
    </div>
  </dd>

  <dt>
    <strong>codesnip-share/snippets/snippet/required-snippets</strong> <em>(optional)</em>
  </dt>
  <dd>
    <div class="half-spaced">
      Contains a set of nodes specifying the identifiers of snippets on which this snippet depends.
    </div>
    <div class="half-spaced">
      This node has special significance when the source language is Pascal. It is used when test compiling Pascal snippets to ensure that any snippets required to compile this snippet are included in the unit used to perform the test compile.
    </div>
  </dd>

  <dt>
    <strong>codesnip-share/snippets/snippet/required-snippets/snippet-id</strong>
  </dt>
  <dd>
    <div class="half-spaced">
      Contains the id of one required snippet. Any prefix specified by the <em>codesnip-share/snippet-id-prefix</em> will be prepended to the snippet ID before use.
    </div>
    <div class="half-spaced">
      <strong>Must</strong> be a valid ID, i.e. it must contain only letters, numbers, hyphens or underscore characters. The total length of a snippet id, including any prefix, <strong>must</strong> not exceed 64 characters.
    </div>
    <div class="half-spaced">
      A <em>codesnip-share/snippets/snippet</em> node <strong>must</strong> exist within this file with same id as the one specified here. Further, the ID <strong>must not</strong> be the ID of this snippet.
    </div>
  </dd>

  <dt>
    <strong>codesnip-share/snippets/snippet/xrefs</strong> <em>(optional)</em>
  </dt>
  <dd>
    <div class="half-spaced">
      Contains a set of nodes specifying the identifiers of cross-referenced snippets.
    </div>
  </dd>

  <dt>
    <strong>codesnip-share/snippets/snippet/xrefs/snippet-id</strong>
  </dt>
  <dd>
    <div class="half-spaced">
      Contains the id of one cross-referenced snippet. Any prefix specified by the <em>codesnip-share/snippet-id-prefix</em> will be prepended to the snippet ID before use.
    </div>
    <div class="half-spaced">
      <strong>Must</strong> be a valid ID, i.e. it must contain only letters, numbers, hyphens or underscore characters. The total length of a snippet id, including any prefix, <strong>must not</strong> exceed 64 characters.
    </div>
    <div class="half-spaced">
      A <em>codesnip-share/snippets/snippet</em> node <strong>must</strong> exist within this file with same id as the one specified here. Further, the ID <strong>must not</strong> be the ID of this snippet.
    </div>
  </dd>

</dl>


<h3 id="source_files">
  Source Code File Format
</h3>

<p>
  Source code files are plain text files containing the source code for a simple snippet.
</p>

<p>
  The files are encoded in UTF&#8209;8 format with no UTF&#8209;8 preamble (BOM).
</p>


<h3 id="package_files">
  Package File Format
</h3>

<p>
  The XML file and source code files are packaged together into a single binary package file using the <a href="package.html">Package file format</a> with a file id of <code>0x8380</code>.
</p>


<h3 id="license_file">
  License File Format
</h3>

<p>
  This file must be named <code>LICENSE</code>. It is a plain text file containing the text of the license that applies to all source code in the share<sup>&dagger;</sup>.
</p>

<p>
  The <a href="https://opensource.org/licenses/MIT">MIT License</a> is recommended to enable maximum flexibility in re-using the code, while asserting copyright and providing a disclaimer.
</p>

<p>
  The file is encoded in UTF&#8209;8 format with no UTF&#8209;8 preamble (BOM).
</p>

<p>
  <strong>&dagger; Note:</strong> If a snippet's source code specifies a license then it overrides the license in the license file.
</p>

</body>

</html>
